# ========================================================
# Global Ruff Configuration
# ========================================================

extend-exclude = [
    "numpy/__config__.py",
    "numpy/distutils",
    "numpy/typing/_char_codes.py",
    "spin/cmds.py",

    # Submodules & vendored code
    "doc/source/_static/scipy-mathjax",
    "vendored-meson/meson",
    "numpy/fft/pocketfft",
    "numpy/_core/src/umath/svml",
    "numpy/_core/src/npysort/x86-simd-sort",
    "numpy/_core/src/highway",
    "numpy/_core/src/common/pythoncapi-compat",
]

extend-include = ["*.py", "*.pyi"]

line-length = 88

# --------------------------------------------------------
# Formatting
# --------------------------------------------------------
[format]
line-ending = "lf"
indent-style = "space"

# ========================================================
# Lint Configuration
# ========================================================
[lint]
preview = true
extend-select = [
    "B",    # flake8-bugbear
    "C4",   # flake8-comprehensions
    "ISC",  # flake8-implicit-str-concat
    "LOG",  # flake8-logging
    "G",    # flake8-logging-format
    "PIE",  # flake8-pie
    "Q",    # flake8-quotes
    "TID",  # flake8-tidy-imports
    "FLY",  # flynt
    "I",    # isort
    "PD",   # pandas-vet
    "PERF", # perflint
    "E",    # pycodestyle/error
    "W",    # pycodestyle/warning
    "PGH",  # pygrep-hooks
    "PLE",  # pylint/error
    "UP",   # pyupgrade
]

ignore = [
    # flake8-bugbear
    "B006", "B007", "B011", "B023", "B028", "B904", "B905",

    # flake8-comprehensions
    "C408",

    # flake8-implicit-str-concat
    "ISC002",

    # flake8-pie
    "PIE790",

    # perflint
    "PERF401",

    # pycodestyle/error
    "E241", "E265", "E266", "E302", "E402", "E712",
    "E721", "E731", "E741",

    # pyflakes
    "F403", "F405", "F821", "F841",

    # pyupgrade
    "UP015", "UP031",
]

# ========================================================
# Per-file Ignores
# ========================================================
[lint.per-file-ignores]
"_tempita.py" = ["B909"]
"bench_*.py" = ["B015", "B018"]
"test*.py" = ["B015", "B018", "E201", "E714"]

# Long-line exceptions for specific NumPy test files
"numpy/_core/tests/test_arrayprint.py" = ["E501"]
"numpy/_core/tests/test_cpu_dispatcher.py" = ["E501"]
"numpy/_core/tests/test_cpu_features.py" = ["E501"]
"numpy/_core/tests/test_dtype.py" = ["E501"]
"numpy/_core/tests/test_defchararray.py" = ["E501"]
"numpy/_core/tests/test_einsum.py" = ["E501"]
"numpy/_core/tests/test_multiarray.py" = ["E501"]
"numpy/_core/tests/test_nditer*py" = ["E501"]
"numpy/_core/tests/test_umath.py" = ["E501"]
"numpy/_core/tests/test_numerictypes.py" = ["E501"]
"numpy/_core/tests/test_regression.py" = ["E501"]
"numpy/_core/_add_newdocs.py" = ["E501"]
"numpy/_core/_add_newdocs_scalars.py" = ["E501"]
"numpy/_core/code_generators/generate_umath.py" = ["E501"]
"numpy/lib/tests/test_format.py" = ["E501"]
"numpy/linalg/tests/test_linalg.py" = ["E501"]
"numpy/f2py/*py" = ["E501"]

# Typing guidelines â€” allow long lines
"numpy/_typing/_array_like.py" = ["E501"]
"numpy/_typing/_dtype_like.py" = ["E501"]
"numpy*pyi" = ["E501"]

# Useless assignments allowed inside typing tests
"numpy/typing/tests/data/*" = ["B015", "B018", "E501"]

# Disable quotes check globally (too disruptive)
"**/*.py" = ["Q"]

# Module-level ignores
"__init__.py" = ["F401", "F403", "F405"]
"__init__.pyi" = ["F401"]
"numpy/_core/defchararray.py" = ["F403", "F405"]
"numpy/_core/multiarray.py" = ["F405"]
"numpy/_core/numeric.py" = ["F403", "F405"]
"numpy/_core/umath.py" = ["F401", "F403", "F405"]
"numpy/f2py/capi_maps.py" = ["F403", "F405"]
"numpy/f2py/crackfortran.py" = ["F403", "F405"]
"numpy/f2py/f90mod_rules.py" = ["F403", "F405"]
"numpy/ma/core.pyi" = ["F403", "F405"]
"numpy/matlib.py" = ["F405"]
"numpy/matlib.pyi" = ["F811"]

# ========================================================
# Plugin-specific Settings
# ========================================================

[lint.flake8-builtins]
builtins-allowed-modules = ["random", "typing"]

[lint.flake8-import-conventions.extend-aliases]
"numpy" = "np"
"numpy.typing" = "npt"
"typing_extensions" = "te"

[lint.isort]
extra-standard-library = ["_typeshed", "typing_extensions"]
known-first-party = ["numpy"]
combine-as-imports = true
split-on-trailing-comma = false
